<div class="mcs-default-container campaign-report" ng-controller="core/campaigns/report/BasicReportCampaignController">
  <div class="mcs-default-sidebar report-sidebar">
    <a class="mics-btn mics-btn-action" ng-click="editCampaign(campaign)">Edit Campaign</a><br>
    <a class="mics-btn mics-btn-delete" ng-click="deleteCampaign(campaign)">Delete Campaign</a>
  </div>
  <div class="report mcs-default-content">

    <div class="campaign-heading">
      <h2>
        <span>{{campaign.name}}</span>

        <div mics-campaign-status="campaign"></div>
        <div class="pull-right">
          <button type="button" class="mics-btn mics-btn-action btn-xs" ng-click="refresh()">
            <span class="glyphicon glyphicon-refresh"></span>
            Refresh
          </button>
        </div>
      </h2>
    </div>

    <div class="chart-controller">
      <div class="report-type-controller">
        <ul class="nav nav-pills">
          <li class="active"><a>Overview</a></li>
          <!-- <li class=""><a href="#">Intraday</a></li> -->
          <!-- <li><a href="#">Trading Reports</a></li> -->
        </ul>
      </div>
      <div class="report-date-controller">
        <form class="form-inline" role="form">
          <input type="daterange" ng-model="reportDateRange" class="form-control range" format="L" ranges="reportDefaultDateRanges" opens="'left'">
        </form>
      </div>
    </div>

    <div ng-class="chartArea">
      <div class="kpi-area">
        <dl>
          <dt ng-if="kpis.cpa">CPA</dt>
          <dd ng-if="kpis.cpa">{{kpis.cpa | number:2 | currencyWithSymbol:campaign.currency_code}}</dd>
          <dt>CPC</dt>
          <dd>{{kpis.cpc | number:2 | currencyWithSymbol:campaign.currency_code}}</dd>
          <dt>CTR</dt>
          <dd>{{kpis.ctr | number }} %</dd>
          <dt>CPM</dt>
          <dd>{{kpis.cpm | number:2 | currencyWithSymbol:campaign.currency_code }}</dd>
          <dt>Spent</dt>
          <dd>{{kpis.impressions_cost | number:2 | currencyWithSymbol:campaign.currency_code}}</dd>
        </dl>
        <!--<hr>-->
        <!--<button ng-click="showDetails()" class="mics-btn mics-btn-continue">Details</button>-->
      </div>
      <div ng-show="details" class="kpi-details">
        <dl>
          <dt>Weekly Budget</dt>
          <dd>{{campaign.max_daily_budget * 7 | number}} €</dd>
        </dl>
      </div>
      <div class="medium-chart">
        <div class="row">
          <div class="col-xs-12">
            <div class="chart"
                 mics-double-line-chart
                 interpolate="linear"
                 clipEdge="true"
                 data="chartData"
                 height="110%"
                 width="100%"
                 singleday="dateRangeIsToday()"
                 hourlymode="isHourlyMode()"
                 timefilter="chartTimeFilter">
            </div>
          </div>
        </div>
        <div class="row chart-legend">
          <div class="col-xs-6">
            <span class="y2-legend">{{getChartName(charts[0])}}</span>
            <span class="y1-legend">{{getChartName(charts[1])}}</span>
            <button class="mics-btn mics-btn-continue selection-button" ng-click="chooseCharts()">
              <span class="caret"></span></button>
          </div>
          <div class="col-xs-offset-4 col-xs-2">
            <select id="role" ng-model="timeFilter" class="form-control precision-filter" ng-click="refresh()" ng-options="timeFilter for timeFilter in timeFilters" ng-disabled="dateRangeIsToday()"></select>
          </div>
        </div>
      </div>
    </div>

    <hr/>

    <!-- Tab set: Ads, AdGroups and Sites -->

    <div class="breakdown-area">
      <div class="panel-body">
        <tabset class="breakdown">

          <!--Ads Tab-->
          <tab heading="Ads">
            <table class="mics-table" data-toggle="table" data-sort-name="asd" data-sort-order="desc">
              <thead>
              <tr>
                <th class="status" ng-click="sortBy('status')">
                  Status
                  <span ng-show="orderBy == 'status'"><span ng-show="!reverseSort">▼</span><span ng-show="reverseSort">▲</span></span>
                </th>
                <th ng-click="sortBy('name')">
                  Name
                  <span ng-show="orderBy == 'name'"><span ng-show="!reverseSort">▼</span><span ng-show="reverseSort">▲</span></span>
                </th>
                <th ng-click="sortBy('format')">
                  Format
                  <span ng-show="orderBy == 'format'"><span ng-show="!reverseSort">▼</span><span ng-show="reverseSort">▲</span></span>
                </th>
                <th ng-click="sortBy(key)" class="metrics" ng-repeat="(key, info) in adsInfo[0].ad.info">
                  {{ adPerformance.getMetricName(key) }}
                  <span ng-show="orderBy == key"><span ng-show="!reverseSort">▼</span><span ng-show="reverseSort">▲</span></span>
                </th>
              </tr>
              </thead>
              <tbody>
              <tr ng-repeat="row in adsInfo">
                <td>
                  <div mics-ad-status="row.ad" ad-group="row.ad_group" campaign="campaign"></div>
                  <span class="badge creative-audit-notification-warning"
                        popover="The creative has the status {{row.ad.creative_audit_status}}"
                        popover-trigger="mouseenter"
                        ng-if="row.ad.creative_audit_status == 'NOT_AUDITED'">?</span>
                  <span class="badge creative-audit-notification-warning"
                        popover="The creative has the status {{row.ad.creative_audit_status}} and will be used as soon as the audit finish."
                        popover-trigger="mouseenter"
                        ng-if="row.ad.creative_audit_status == 'AUDIT_PENDING'">?</span>
                  <span class="badge creative-audit-notification-alert"
                        popover="One or more audits failed, this creative may not be used everywhere !"
                        popover-trigger="mouseenter"
                        ng-if="row.ad.creative_audit_status == 'AUDIT_FAILED' || row.ad.creative_audit_status == 'AUDIT_PARTIALLY_PASSED'">!</span>
                </td>
                <td><a href="#{{getCreativeUrl(row.ad)}}">{{row.ad.name}}</a></td>
                <td>{{row.ad.format}}</td>
                <td class="metrics" ng-repeat="info in row.ad.info">
                  <span ng-if="info.type == 'currency' && info.value != undefined">
                    {{info.value | number:2 | currencyWithSymbol:campaign.currency_code}}
                  </span>
                  <span ng-if="info.type == 'percent' && info.value != undefined">{{info.value | number}} %</span>
                  <span ng-if="info.type == 'number' && info.value != undefined">{{info.value | number}}</span>
                  <span ng-if="!info.type || info.value == undefined"> - </span>
                </td>
              </tr>
              </tbody>
            </table>
          </tab>

          <!--AdGroups Tab -->
          <tab heading="Ad groups">
            <table class="mics-table">
              <thead>
              <tr>
                <th class="status" ng-click="sortBy('adGroupStatus')">
                  Status
                  <span ng-show="orderBy == 'adGroupStatus'"><span ng-show="!reverseSort">▼</span><span ng-show="reverseSort">▲</span></span>
                </th>
                <th ng-click="sortBy('adGroupName')">
                  Name
                  <span ng-show="orderBy == 'adGroupName'"><span ng-show="!reverseSort">▼</span><span ng-show="reverseSort">▲</span></span>
                </th>
                <th class="metrics" ng-repeat="header in adGroupPerformance.getMetrics()">
                  {{ adPerformance.getMetricName(header) }}
                </th>
              </tr>
              </thead>
              <tbody>
              <tr ng-repeat="row in adgroups">
                <td>
                  <div mics-ad-group-status="row" campaign="campaign"></div>
                </td>
                <td>{{row.name}}</td>
                <td class="metrics {{metricValue.type}}"
                    ng-repeat="metricValue in adGroupPerformance.getRow(row.id) track by $index">
                    <span ng-if="metricValue.type == 'currency' && metricValue.value != undefined">
                      {{metricValue.value | number:2 | currencyWithSymbol:campaign.currency_code}}
                    </span>
                    <span ng-if="metricValue.type == 'percent' && metricValue.value != undefined">
                      {{metricValue.value | number}} %
                    </span>
                    <span ng-if="metricValue.type == 'number' && metricValue.value != undefined">
                      {{metricValue.value | number}}
                    </span>
                  <span ng-if="!metricValue.type || metricValue.value == undefined"> - </span>
                </td>
              </tr>
              </tbody>
            </table>
          </tab>


          <!--Sites Tab-->
          <tab heading="Sites">
            <table class="mics-table">
              <thead>
              <tr>
                <th>Site</th>
                <th class="metrics" ng-repeat="header in mediaPerformance.getMetrics()">
                  {{ mediaPerformance.getMetricName(header) }}
                </th>
              </tr>
              </thead>
              <tbody>
              <tr ng-repeat="row in mediaPerformance.getRows()">
                <td>{{row[0] | website }}</td>
                <td class="metrics {{metricValue.type}}"
                    ng-repeat="metricValue in  mediaPerformance.decorate(row) track by $index">
                    <span ng-if="metricValue.type == 'currency' && metricValue.value != undefined">
                      {{metricValue.value | number:2 | currencyWithSymbol:campaign.currency_code}}
                    </span>
                    <span ng-if="metricValue.type == 'percent' && metricValue.value != undefined">
                      {{metricValue.value | number}} %
                    </span>
                    <span ng-if="metricValue.type == 'number' && metricValue.value != undefined">
                      {{metricValue.value | number}}
                    </span>
                  <span ng-if="!metricValue.type || metricValue.value == undefined"> - </span>
                </td>
              </tr>
              </tbody>
            </table>
          </tab>
        </tabset>
      </div>
    </div>
  </div>
</div>
